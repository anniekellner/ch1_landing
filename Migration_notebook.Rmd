---
title: "Polar Bear Migration"
author: "Annie Kellner"
date: "September 26, 2018"
output: html_document
---
```{r}
knitr::opts_chunk$set(echo=FALSE)
```

![Starting and landing points for summer migration (n=19)](map_migration.png)

Westernmost Starting Point: (-161.338, 73.266) <br>
Easternmost Starting Point: (-145.957, 71.274) <br>

Westernmost Landing Point: (-159.668, 70.759) *note: this point is outside my 'study area', but is a SBS bear (not CS) <br>
Easternmost Landing Point: (-143.188, 70.172) <br>
 

```{r, include=FALSE}
library(dplyr)
load('all.RData')

all$temp <- paste(all$animal, all$year) # ID by animal and year

start <- filter(all, start.swim==1)
start <- select(start, temp, gps_lon, gps_lat)

end <- filter(all, end.swim==1)
end <- select(end, temp, gps_lon, gps_lat)

colnames(start) <- c("ID", "start.lon", "start.lat")
colnames(end) <- c("ID", "end.lon", "end.lat")

cor <- full_join(start, end, by="ID")

cor(cor$start.lon, cor$end.lon)
cor(cor$start.lat, cor$end.lat)
fit <- lm(cor$end.lon~cor$start.lon) # regression line (y~x)

plot(cor$start.lon, cor$end.lon, main='Longitudinal correlation between starting and landing', xlab = 'Starting Longitude', ylab = 'Landing Longitude', pch=19)
abline(fit, col='red')
legend('topleft', expression(paste(r,'=0.815, ',italic('P'), '<0.001')))
```

Landing longitude does not appear uniform in histogram

```{r, echo=FALSE}
end <- subset(all, end.swim==1)

end.long <- end$gps_lon
hist(end.long, main="Landing Longitudes", xlab = 'Longitude')
```

Kolmogorov-Smirnov test to see if data conforms to a uniform distribution

```{r}
ks.test(end.long, "punif", 141.00, 156.46)
```

Result: Landing points are not uniform with respect to longitude (support defined by longitudes between Point Barrow and US-Canada border).

```{r}
load('Migration_dist.RData')
```

Minimum migration distance is `r min(swim.len$Distance)` km <br>
Maximum migration distance is `r max(swim.len$Distance)` km <br>
Mean Migration distance is `r mean(swim.len$Distance)` km, with standard deviation `r sd(swim.len$Distance)` km <br>

```{r}
load('swim.az.RData')
```

Mean bearing of migration is `r mean(swim.az$azimuth)` with a standard deviation of `r sd(swim.az$azimuth)`

The deviation from a straight-line path for each bear is as follows:

```{r}
load('Migration_dist.RData')
library(dplyr)
library(knitr)
swim.len <- select(swim.len, id, bear_dist, crow_dist, ratio)
colnames(swim.len) <- c('ID','Travel Distance', 'Straight-Line Distance', 'Ratio')

knitr::kable(swim.len, digits=2, align='r', caption = 'Distance Traveled vs. Straight-Line Distance')
```

* I'm not sure what the best way to present this data is, so I'm just providing this table. One issue with this approach is missing data - i.e., fixes that are NA's. These would bias the path to be 'straighter' than it probably is in reality. I might also remove pb_20525.2013 and pb_21015.2013 from this particular analysis because these two bears had large data gaps during migration. 

**Abbreviated AICc analysis to test whether departure date is better predicted by sea ice concentration at 15 or 30%**

Background: After going through Todd's arrival dates with a fine-tooth comb in an attempt to boost my sample size, I realized I disagreed with the classification of many of his dates as true "arrival" dates for bears that 'migrate' from ice to land. I thought his dates might bias the sea ice towards a lower concentration, so I wanted to run a very course AICc analysis on my own 'start' dates (date on which ice-to-land migration begins). I wanted to use the 30% concentration for comparison because that number reflects the concentration in the top Canadian model (WH population). These are the results:

```{r}
rm(list = ls())
library(dplyr)

#load data
load("all.RData")
ice <- read.csv("sbs_daily_icestats_1979_2017_v6.csv")

#create swim df
start.swim <- subset(all, start.swim==1)

#create temp column
start.swim$tt <- paste(start.swim$year, start.swim$month, start.swim$day)
ice$tt <- paste(ice$year, ice$month, ice$day)

start.swim.ice <- inner_join(start.swim,ice, by="tt")

#isolate icepct 15, 30, 50
icemean <- dplyr::select(start.swim.ice, animal, datetime, year.y, sbs_shelf_icemean_15, sbs_shelf_icemean_30, sbs_shelf_icemean_50)

#change datetime to day-of-year
icemean$doy <- strftime(icemean$datetime, format = "%j")
icemean$doy <- as.numeric(icemean$doy)

#change column names
colnames(icemean) <- c('animal', 'datetime', 'year', 'shelf_15', 'shelf_30', 'shelf_50', 'doy.start')

# remove September arrival dates
icemean <- icemean[-c(1,3),]

# load FD
load('FD.RData')

#Change dates to day-of-year
FD$doy15 <- strftime(FD$FD15, format="%j")
FD$doy15 <- as.numeric(FD$doy15)

FD$doy30 <- strftime(FD$FD30, format="%j")
FD$doy30 <- as.numeric(FD$doy30)

#join icepct and FD df's
pct.FD <- full_join(icemean, FD, by="year")

# run AIC
library(lme4)

model15 <- lmer(doy.start~shelf_15 + (1|animal), data=pct.FD)
model30 <- lmer(doy.start~shelf_30 + (1|animal), data=pct.FD)
model15.FD <- lmer(doy.start~shelf_15 + doy15 + (1|animal), data=pct.FD)
model30.FD <- lmer(doy.start~shelf_30 + doy30 + (1|animal), data=pct.FD)

library(AICcmodavg)
mods = c(model15, model30, model15.FD, model30.FD)
aictab(mods, second.ord = TRUE)
```

Results: Todd's concentration of 15% came out as the "top" model, but there is basically no difference between 15 and 30% (top two models are essentially equally explanatory). In contrast to Todd's paper, I did not find that the FD variable helped explain variation (FD = first day of the year when proportion of shelf covered by < X% sea ice decreased to <=X%) 
 
 Some thoughts: 

- Todd wanted me to look at wind as a variable. I have doubts concerning the accuracy of the data I will be able to get (probably too course to be relevant), but I can try. I removed September bears from this analysis because from the data it appeared their behavior was somewhat different than bears that arrived on land in July and August. The latter made a distinct 'migration' from ice to land, whereas September bears seemed to hop around on tiny little ice floes until landing right when the bonepile began. I'd be interested in seeing whether the effect of wind differed between these groups, although the September group is n=2. So possibly not enough data.     

- Todd did not use 30% ice concentration in his model set. I was interested in this number because it emerged in the top model in the Canadian analysis (Hudson Bay). The Canadian analysis predates Todd's, so I'd be curious why he did not use the 30% measurement. I assume there was good reason. Could ask.  

- Todd used a much larger sample size in his paper (n=68), whereas I used n=19. However, Todd acknowledged in his paper that the GPS data was the more accurate data (relative to Argos data), and I took issue with most of his GPS dates. I should also say I have not discussed this with Todd, so I could be missing something. 

- I was informed by Dave Douglas at USGS that I should not use the ice data I used in this analysis, as there is much finer-scale data available. This would require asking Dave to run analyses for me, so I decided to use the data I already had (given to me by Todd). If we decide to investigate this further, I'd ask Dave for the better data. 

