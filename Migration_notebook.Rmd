---
title: "Polar Bear Migration"
author: "Annie Kellner"
date: "September 26, 2018"
output:
  html_document:
    df_print: paged
---
```{r setup, include = FALSE, echo=FALSE}
library(knitr)

opts_knit$set(root.dir = "C:/Users/akell/OneDrive - Colostate/PhD/Polar_Bears_GIS/R/Chapter1/Landing Analysis/ch1_landing")
knitr::opts_chunk$set(echo=FALSE)
```

I defined migration as follows:

> Northernmost point before a directional southward movement >= 50km, concluding with the first land point during the open water season. 

> More definitions:
> Land = land as defined by the DEM, plus a 5 km buffer to include barrier islands <br>
> Southward Movement = ESE to WSW (101.25 - 258.75) <br>
> First Land Point = First point on land (as described above) after which bear remains on land for >= 7 days (from Atwood et al. 2016)

### Where do the bears begin and end their ice-to-land migration?

![Starting and landing points for summer migration (n=19)](C:/Users/akell/OneDrive - Colostate/PhD/Polar_Bears_GIS/R/Chapter1/Landing Analysis/ch1_landing/map_migration.png)

Westernmost Starting Point: (-161.338, 73.266) <br>
Easternmost Starting Point: (-145.957, 71.274) <br>

Westernmost Landing Point: (-159.668, 70.759) *note: this point is outside my 'study area', but is a SBS bear (not CS) <br>
Easternmost Landing Point: (-143.188, 70.172) <br>

### Are landing points random? 

```{r}
library(dplyr)
load('all.RData')

all$temp <- paste(all$animal, all$year) # ID by animal and year

start <- filter(all, start.swim==1)
start <- select(start, temp, gps_lon, gps_lat)

end <- filter(all, end.swim==1)
end <- select(end, temp, gps_lon, gps_lat)

colnames(start) <- c("ID", "start.lon", "start.lat")
colnames(end) <- c("ID", "end.lon", "end.lat")

cor <- full_join(start, end, by="ID")

cor(cor$start.lon, cor$end.lon)
cor(cor$start.lat, cor$end.lat)
fit <- lm(cor$end.lon~cor$start.lon) # regression line (y~x)

plot(cor$start.lon, cor$end.lon, main='Longitudinal correlation between starting and landing', xlab = 'Starting Longitude', ylab = 'Landing Longitude', pch=19)
abline(fit, col='red')
legend('topleft', expression(paste(r,'=0.815, ',italic('P'), '<0.001')))
```

Landing longitude does not appear uniform in histogram

```{r, echo=FALSE}
end <- subset(all, end.swim==1)

end.long <- end$gps_lon
hist(end.long, main="Landing Longitudes", xlab = 'Longitude')
```

Kolmogorov-Smirnov test to see if data conforms to a uniform distribution

```{r}
ks.test(end.long, "punif", 141.00, 156.46)
```

Result: Landing points are not uniform with respect to longitude (support defined by longitudes between Point Barrow and US-Canada border).

### How far do the bears travel and how long does it take?

```{r, include=FALSE}
load('Migration_dist.RData')
library(dplyr)
library(knitr)
```
Minimum migration distance is `r min(swim.len$bear_dist)` km <br>
Maximum migration distance is `r max(swim.len$bear_dist)` km <br>
Mean Migration distance is `r mean(swim.len$bear_dist)` km, with standard deviation `r sd(swim.len$bear_dist)` km <br>


```{r}
swim.len <- select(swim.len, id, bear_dist, crow_dist, ratio)
colnames(swim.len) <- c('ID','Travel Distance', 'Straight-Line Distance', 'Ratio')
knitr::kable(swim.len, digits=2, align='r', caption = 'Distance Traveled vs. Straight-Line Distance')
```



* I'm not sure what the best way to present this data is, so I'm just providing this table. One issue with this approach is missing data - i.e., fixes that are NA's. These would bias the path to be 'straighter' than it probably is in reality. I might also remove pb_20525.2013 and pb_21015.2013 from this particular analysis because these two bears had large data gaps during migration.

```{r, include=FALSE}
library(dplyr)

load('all.RData')
start <- subset(all, start.swim==1)
end <- subset(all, end.swim==1)

mig <- left_join(start,end, by='id')
mig <- select(mig, animal.x, datetime.x, datetime.y)

colnames(mig) <- c('animal', 'start', 'end')

mig$diff <- difftime(mig$end, mig$start, tz='US/Alaska', units="days")
```
```{r}
knitr::kable(mig, digits=2, align='r', caption = 'Migration Time')
```

Mean travel time = `r mean(mig$diff)` days with SD `r sd(mig$diff)` days <br>
Min travel time = `r min(mig$diff)` days <br>
Max travel time = `r max(mig$diff)` days <br>

```{r}
load('swim.az.RData')
swim.az$azimuth <- as.numeric(swim.az$azimuth)
```

Mean bearing of migration is `r mean(swim.az$azimuth, na.rm=TRUE)` (SSW) with a standard deviation of `r sd(swim.az$azimuth, na.rm = TRUE)`

# Bonepile Bears


```{r, include=FALSE}
load('ows_land.RData')

bone <- subset(ows.land, bonepile==1)
bone <- droplevels(bone)
nobone <- subset(ows.land, bonepile==0)
nobone <- droplevels(nobone)
```

There are `r length(unique(bone$animal))` "bonepile bears".
There are `r length(unique(nobone$animal))` "non-bonepile bears"

```{r}
library(dplyr)
library(lubridate)
library(ggplot2)

# as.Date 
start <- subset(all, start.swim==1) %>%  droplevels() 
start$ymd <- paste(start$year, start$month, start$day, sep = '-')
start$ymd <- ymd(start$ymd)

#convert to doy
start$doy <- strftime(start$ymd, format="%j")
start$doy <- as.numeric(start$doy)

start$md <- format(strptime(start$doy, format="%j"), format="%b-%d") 

#Subset bonepile = 0
nb <- subset(ows.land, bonepile==0) %>% droplevels()


# plot density curve
ggplot(start, aes(doy))+
  geom_density() +
  xlab("Day-of-Year") +
  geom_vline(xintercept = 212, color="blue") +
  geom_vline(xintercept = 222, color="blue") +
  geom_vline(xintercept = 258, color="blue") +
  ggtitle("Distribution of departure dates: from ice to land") 
```




Blue lines represent migration departure dates for the three non-bonepile bears for which I have departure information. 

* I believe the bear that arrived on day 258 is a 'denning' bear. I have asked Todd for a list of denning bears so that I can eliminate them from my analysis. However, it's interesting to note that bears that den on land are not necessarily bears that summer on land, or bears that make use of the bonepiles (even though they may arrive prior to the bonepile).  

